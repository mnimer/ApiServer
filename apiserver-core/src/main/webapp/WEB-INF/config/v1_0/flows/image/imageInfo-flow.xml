<?xml version="1.0" encoding="UTF-8"?>
<beans
        xmlns:http="http://www.springframework.org/schema/integration/http"
        xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:si="http://www.springframework.org/schema/integration"
        xsi:schemaLocation="http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/integration/http http://www.springframework.org/schema/integration/http/spring-integration-http.xsd">


    <si:channel id="imageInfoRequestChannel">
        <si:queue/>
    </si:channel>

    <si:channel id="imageInfoReplyChannel">
        <si:queue/>
    </si:channel>

    <si:channel id="imageInfoHTTPChannel">
        <si:queue/>
    </si:channel>


    <si:gateway id="imageInfoApiGateway"
                service-interface="apiserver.apis.v1_0.images.gateways.images.ImageInfoGateway"
                default-reply-channel="imageInfoReplyChannel"
                default-reply-timeout="#{applicationProperties.defaultReplyTimeout}">

        <si:method name="imageInfo"
                   request-channel="imageInfoRequestChannel"
                   payload-expression="#args[0]">
            <si:header name="REQUEST_TYPE" value="#{coldfusionProperties.REQUEST_TYPE}"/>
        </si:method>
    </si:gateway>


    <si:header-value-router input-channel="imageInfoRequestChannel"
                            header-name="REQUEST_TYPE">
        <si:poller fixed-rate="100" max-messages-per-poll="1" />
        <si:mapping value="http" channel="imageInfoHTTPChannel"/>
    </si:header-value-router>


    <si:chain id="trafficGatewayChain"
              input-channel="imageInfoHTTPChannel"
              output-channel="imageInfoReplyChannel">

        <si:service-activator
                method="execute">
            <bean class="apiserver.apis.v1_0.images.services.coldfusion.ImageInfoService"/>
        </si:service-activator>


        <si:json-to-object-transformer type="java.util.HashMap"/>

    </si:chain>

</beans>
        
