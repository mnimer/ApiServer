<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">

    <!-- @see http://se-jcr.sourceforge.net/guide.html
        @see http://www.infoq.com/articles/spring-modules-jcr-->


    <bean id="repository" class="org.apache.jackrabbit.core.RepositoryImpl">
        <constructor-arg index="0" ref="config"/>
    </bean>

    <bean id="config" class="org.apache.jackrabbit.core.config.RepositoryConfig" factory-method="create">
        <constructor-arg index="0" value="src/main/webapp/WEB-INF/jackrabbit/repository.xml"/>
        <constructor-arg index="1" value="./target/repository"/>
    </bean>


    <!--
    <bean id="repository" class="org.springmodules.jcr.jackrabbit.RepositoryFactoryBean">
        <property name="configuration" value="/WEB-INF/jackrabbit/repository.xml"/>
        <property name="homeDir" value="file:./target/repo"/>
    </bean>


    <bean id="sessionFactory"
          class="org.springmodules.jcr.jackrabbit.JackrabbitSessionFactory">
        <property name="repository" ref="repository" />
    </bean>

    <bean id="jcrTemplate" class="org.springmodules.jcr.JcrTemplate">
        <property name="sessionFactory" ref="sessionFactory" />
        <property name="allowCreate" value="true" />
    </bean>
        -->

    <!-- Session Factory
    <bean id="jcrSessionFactory" class="org.springmodules.jcr.JcrSessionFactory">
        <property name="repository" ref="repository"/>
        <property name="credentials">
            <bean class="javax.jcr.SimpleCredentials">
                <constructor-arg index="0" value="admin"/>
                <constructor-arg index="1">
                    <bean factory-bean="jcrPassword" factory-method="toCharArray"/>
                </constructor-arg>
            </bean>
        </property>
    </bean>   -->

    <!-- create the password to return it as a char[]
    <bean id="jcrPassword" class="java.lang.String">
        <constructor-arg index="0" value="admin"/>
    </bean>      -->

    <!--
    <bean id="openSessionInViewInterceptor" class="org.springmodules.jcr.support.OpenSessionInViewInterceptor">
        <property name="sessionFactory">
            <ref bean="jcrSessionFactory" />
        </property>
    </bean>


    <bean id="jcrTemplate" class="org.springmodules.jcr.JcrTemplate">
        <property name="sessionFactory" ref="jcrSessionFactory"/>
        <property name="allowCreate" value="true"/>
    </bean>  -->

    <!--
    <bean id="repository" class="org.apache.jackrabbit.core.RepositoryImpl">
        <constructor-arg index="0" ref="config"/>
    </bean>
    <bean id="config" class="org.apache.jackrabbit.core.config.RepositoryConfig" factory-method="create">
        <constructor-arg index="0" value="/WEB-INF/jackrabbit/repository.xml"/>
        <constructor-arg index="1" value="/WEB-INF/jackrabbit/repository"/>
    </bean>
    -->


    <bean class="org.springframework.web.context.support.ServletContextAttributeExporter">
        <property name="attributes">
            <map>
                <entry key="javax.jcr.Repository" value-ref="repository"/>
            </map>
        </property>
    </bean>

</beans>